From 1f07c4a4242702da4e170cc30cdc29c7373a4f72 Mon Sep 17 00:00:00 2001
From: hackademix <giorgio@maone.net>
Date: Sun, 10 Mar 2024 15:01:07 +0100
Subject: [PATCH] BB 42443: Shrink window to match letterboxing size when the
 emtpy area is clicked.

---
 .../components/resistfingerprinting/RFPHelper.sys.mjs  | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/toolkit/components/resistfingerprinting/RFPHelper.sys.mjs b/toolkit/components/resistfingerprinting/RFPHelper.sys.mjs
index 6db5dd0cf9..8598db8b6e 100644
--- a/toolkit/components/resistfingerprinting/RFPHelper.sys.mjs
+++ b/toolkit/components/resistfingerprinting/RFPHelper.sys.mjs
@@ -754,8 +754,16 @@ class _RFPHelper {
     return false;
   }
 
+  _onWindowDoubleClick(e) {
+    if (e.target.classList.contains("browserStack")) {
+      e.currentTarget.shrinkToLetterbox();
+    }
+  }
+
   _attachWindow(aWindow) {
     this._fixRounding(aWindow);
+    aWindow.shrinkToLetterbox = this.shrinkToLetterbox;
+    aWindow.addEventListener("dblclick", this._onWindowDoubleClick);
     aWindow.gBrowser.addTabsProgressListener(this);
     aWindow.addEventListener("TabOpen", this);
     let resizeObserver = new aWindow.ResizeObserver(entries => {
@@ -1036,6 +1044,8 @@ class _RFPHelper {
       let browser = tab.linkedBrowser;
       this._resetContentSize(browser);
     }
+    aWindow.removeEventListener("dblclick", this._onWindowDoubleClick);
+    delete aWindow.shrinkToLetterbox;
 
     aWindow.removeEventListener("nativethemechange", this);
     this._updateLetterboxingColors(aWindow, false);
-- 
2.52.0

